---
title: "Captcha Service With Python and Redis"
date: 2019-02-16T20:32:13+08:00
draft: true
tags: ["captcha","python","redis","web"]
---

## Intro
While implementing my new personal website, I added a `Contact` page, on which people can send messages to me by filling a form.

This is a low-cost way to say something to the owner of the website. It can be anonymous, for instance, you can just type `yo` in the message box and click `Send`, then seconds later, I receive an email showing the message, and I have no idea who you are.

This feature looks convenient but also opens a window to everyone who wants to spam me. Someone may even willing to spend time writing a load-testing script for me (sending hundreds of thousands of messages to me within seconds to see if the website can handle it).

To prevent such case happens, I have to add a `CAPTCHA` (`c`ompletely `a`utomated `p`ublic `T`uring test to tell `c`omputers and `h`umans `a`part) field. As a result, it became hard for people to write a program to flood my inbox.

My homepage is a static page generated by `Vue`, it requests external APIs through Javascript. Thus, the sending email service, or with the captcha service, is a standalone service running on my server.

## Design
```
   User           Web Page               Server            Redis
    |                |                      |                |
    |--click send--->|                      |                |
    |                |-----request key----->|                |
    |                |                 generate key          |
    |                |                      |---save key---->|
    |                |<----return key-------|                |
    |                |--request img by key->|                |
    |                |              generate code & img      |
    |                |                      |---save code--->|
    |                |<-----return img------|                |
    |--input code--->|                      |                |
    |                |----send code & key-->|                |
    |                |                      |------key------>|
    |                |                      |<-----code------|
    |                |                compare codes          |
    |                |             op(e.g. send email)       |
    |                |<----return result----|                |
```

